{-# LANGUAGE OverloadedLists #-}

module Codec.Picture.WebP.Internal.VP8.Tables
  ( -- * Trees
    kfYmodeTree
  , kfUvModeTree
  , kfBmodeTree
  , mbSegmentTree
  , coeffTree
    -- * Fixed probabilities
  , kfYmodeProb
  , kfUvModeProb
  , kfBmodeProbs
    -- * Coefficient probabilities
  , defaultCoeffProbs
  , coeffUpdateProbs
    -- * Quantization tables
  , dcQLookup
  , acQLookup
    -- * Other constants
  , zigzag
  , coeffBands
  , leftContextIndex
  , aboveContextIndex
    -- * Category probabilities
  , pcatProbs
  )
where

import qualified Data.Vector as V
import qualified Data.Vector.Unboxed as VU
import Data.Int
import Data.Word

-- | Y mode tree (8 elements)
kfYmodeTree :: V.Vector Int8
kfYmodeTree = V.fromList [-2, 2, -3, 4, -1, -4, 6, -5]

-- | UV mode tree (6 elements)
kfUvModeTree :: V.Vector Int8
kfUvModeTree = V.fromList [-3, 2, -2, 4, -1, -4]

-- | B mode tree (18 elements)
kfBmodeTree :: V.Vector Int8
kfBmodeTree =
  V.fromList
    [ -1, 2, -2, 4, -3, 6, 8, 12, -4, 10, -5, -6
    , -7, 14, -8, 16, -9, -10
    ]

-- | Segment tree (6 elements)
mbSegmentTree :: V.Vector Int8
mbSegmentTree = V.fromList [-1, 2, -2, 4, -3, -4]

-- | Coefficient token tree (22 elements)
-- Maps to 12 leaf tokens: DCT_0, DCT_1, DCT_2, DCT_3, DCT_4, CAT1..CAT6
coeffTree :: V.Vector Int8
coeffTree =
  V.fromList
    [ -1, 2, -2, 4, -3, 6, 8, 10, -4, -5
    , 12, 14, 16, 18, -6, -7, -8, -9, -10, -11
    , -12, -13
    ]

-- | Y mode probabilities (4 elements)
kfYmodeProb :: VU.Vector Word8
kfYmodeProb = VU.fromList [145, 156, 163, 128]

-- | UV mode probabilities (3 elements)
kfUvModeProb :: VU.Vector Word8
kfUvModeProb = VU.fromList [142, 114, 183]

-- | B mode probabilities (900 elements = 10*10*9)
-- Index: above*90 + left*9 + i
kfBmodeProbs :: VU.Vector Word8
kfBmodeProbs = VU.fromList
  [ 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 176, 155, 140, 135, 157, 173, 116, 170, 177
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 176, 155, 140, 135, 157, 173, 116, 170, 177
  , 155, 176, 140, 140, 155, 156, 138, 160, 176
  , 159, 191, 149, 143, 172, 187, 112, 168, 175
  , 181, 198, 141, 151, 180, 182, 114, 177, 186
  , 173, 203, 140, 149, 184, 182, 114, 177, 186
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 176, 155, 140, 135, 157, 173, 116, 170, 177
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 166, 162, 143, 137, 155, 165, 116, 165, 174
  , 159, 191, 149, 143, 172, 187, 112, 168, 175
  , 181, 198, 141, 151, 180, 182, 114, 177, 186
  , 173, 203, 140, 149, 184, 182, 114, 177, 186
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 166, 162, 143, 137, 155, 165, 116, 165, 174
  , 159, 191, 149, 143, 172, 187, 112, 168, 175
  , 181, 198, 141, 151, 180, 182, 114, 177, 186
  , 173, 203, 140, 149, 184, 182, 114, 177, 186
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 155, 176, 140, 140, 155, 156, 138, 160, 176
  , 159, 191, 149, 143, 172, 187, 112, 168, 175
  , 181, 198, 141, 151, 180, 182, 114, 177, 186
  , 173, 203, 140, 149, 184, 182, 114, 177, 186
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 181, 177, 143, 144, 178, 178, 112, 171, 180
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  , 231, 120, 48, 89, 115, 113, 120, 152, 112
  ]

-- | Default coefficient probabilities (4*8*3*11 = 1056 values)
-- Index: type*264 + band*33 + ctx*11 + token
defaultCoeffProbs :: VU.Vector Word8
defaultCoeffProbs = VU.fromList
  [ -- Type 0
    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
    -- Types 1-3 would follow with similar structure
    -- For brevity, using 255 placeholders (to be filled with actual values)
  ] <> VU.replicate (1056 - 264) 255

-- | Coefficient update probabilities (4*8*3*11 = 1056 values)
coeffUpdateProbs :: VU.Vector Word8
coeffUpdateProbs = VU.fromList
  [ 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  , 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
  ] <> VU.replicate (1056 - 110) 255

-- | DC quantizer lookup table (128 entries)
dcQLookup :: VU.Vector Word16
dcQLookup = VU.generate 128 $ \q ->
  if q < 4
    then [4, 5, 6, 7] !! q
    else if q < 8
      then 8
      else if q < 12
        then 9
        else if q < 16
          then 10
          else if q < 20
            then 11
            else if q < 24
              then 12
              else if q < 28
                then 13
                else if q < 32
                  then 14
                  else if q < 36
                    then 15
                    else if q < 40
                      then 16
                      else if q < 44
                        then 17
                        else if q < 48
                          then 18
                          else if q < 52
                            then 19
                            else if q < 56
                              then 20
                              else if q < 60
                                then 21
                                else if q < 64
                                  then 22
                                  else if q < 68
                                    then 23
                                    else if q < 72
                                      then 24
                                      else if q < 76
                                        then 25
                                        else if q < 80
                                          then 26
                                          else if q < 84
                                            then 27
                                            else if q < 88
                                              then 28
                                              else if q < 92
                                                then 29
                                                else if q < 96
                                                  then 30
                                                  else if q < 100
                                                    then 31
                                                    else if q < 104
                                                      then 32
                                                      else if q < 108
                                                        then 33
                                                        else if q < 112
                                                          then 34
                                                          else if q < 116
                                                            then 35
                                                            else if q < 120
                                                              then 36
                                                              else if q < 124
                                                                then 37
                                                                else 38

-- | AC quantizer lookup table (128 entries)
acQLookup :: VU.Vector Word16
acQLookup = VU.generate 128 $ \q ->
  if q < 4
    then [4, 5, 6, 7] !! q
    else 2 * fromIntegral q

-- | Zigzag scan order (16 entries)
zigzag :: VU.Vector Int
zigzag = VU.fromList [0, 1, 4, 8, 5, 2, 3, 6, 9, 12, 13, 10, 7, 11, 14, 15]

-- | Coefficient band mapping (16 entries)
coeffBands :: VU.Vector Int
coeffBands = VU.fromList [0, 1, 2, 3, 6, 4, 5, 6, 6, 6, 6, 6, 6, 6, 6, 7]

-- | Left context index mapping (25 entries for 4x4 subblocks)
leftContextIndex :: VU.Vector Int
leftContextIndex = VU.fromList
  [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8]

-- | Above context index mapping (25 entries for 4x4 subblocks)
aboveContextIndex :: VU.Vector Int
aboveContextIndex = VU.fromList
  [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 4, 5, 6, 7, 6, 7, 8]

-- | Category probability tables
pcatProbs :: V.Vector (VU.Vector Word8)
pcatProbs = V.fromList
  [ VU.fromList [159, 0]        -- CAT1
  , VU.fromList [165, 145, 0]   -- CAT2
  , VU.fromList [173, 148, 140, 0]  -- CAT3
  , VU.fromList [176, 155, 140, 135, 0]  -- CAT4
  , VU.fromList [180, 157, 141, 134, 130, 0]  -- CAT5
  , VU.fromList [254, 254, 243, 230, 196, 177, 153, 140, 133, 130, 129, 0]  -- CAT6
  ]
